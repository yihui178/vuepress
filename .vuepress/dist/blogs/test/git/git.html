<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="/YihuiLogo.ico"><title>Git的安装和使用 | 忆‌回</title><meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/style-CHlD3ZCd.css" as="style"><link rel="stylesheet" href="/assets/style-CHlD3ZCd.css">
    <link rel="modulepreload" href="/assets/app-Ch_-uG_H.js"><link rel="modulepreload" href="/assets/git.html-KY2AaoAn.js">
    <link rel="prefetch" href="/assets/timeline.html-BooOFR40.js" as="script"><link rel="prefetch" href="/assets/posts.html-Btumt1im.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-IR6mugsA.js" as="script"><link rel="prefetch" href="/assets/1.html-Cb5punan.js" as="script"><link rel="prefetch" href="/assets/1.html-Cxw_H0YV.js" as="script"><link rel="prefetch" href="/assets/1.html-C9YW6ON1.js" as="script"><link rel="prefetch" href="/assets/1.html-D7I7Lp6N.js" as="script"><link rel="prefetch" href="/assets/1.html-CvoOO3t0.js" as="script"><link rel="prefetch" href="/assets/1.html-Yake3B6S.js" as="script"><link rel="prefetch" href="/assets/1.html-D5AtSq9x.js" as="script"><link rel="prefetch" href="/assets/1.html-BCWdxClP.js" as="script"><link rel="prefetch" href="/assets/1.html-Dz9coJzJ.js" as="script"><link rel="prefetch" href="/assets/1.html-cns4VcbG.js" as="script"><link rel="prefetch" href="/assets/1.html-Cn0By7jp.js" as="script"><link rel="prefetch" href="/assets/1.html-CQSeotsA.js" as="script"><link rel="prefetch" href="/assets/1.html-Cdrzw6fp.js" as="script"><link rel="prefetch" href="/assets/1.html-WM0LSWHP.js" as="script"><link rel="prefetch" href="/assets/1.html-D9OhP_Sc.js" as="script"><link rel="prefetch" href="/assets/index.html-DZwVRtzv.js" as="script"><link rel="prefetch" href="/assets/guide.html-C5op0veG.js" as="script"><link rel="prefetch" href="/assets/api.html-BKbTf-xd.js" as="script"><link rel="prefetch" href="/assets/home.html-Ct08zw4I.js" as="script"><link rel="prefetch" href="/assets/plugin.html-SJdUPNg9.js" as="script"><link rel="prefetch" href="/assets/theme.html-Be7x-XHP.js" as="script"><link rel="prefetch" href="/assets/docker.html-BM1DibIS.js" as="script"><link rel="prefetch" href="/assets/index.html-D73awf9Q.js" as="script"><link rel="prefetch" href="/assets/MyBatis-Plus.html-BQNFnuLV.js" as="script"><link rel="prefetch" href="/assets/springboot.html-DgxjwlkN.js" as="script"><link rel="prefetch" href="/assets/Swagger.html-BRU9WxrZ.js" as="script"><link rel="prefetch" href="/assets/docker.html-C4SeHRw3.js" as="script"><link rel="prefetch" href="/assets/git.html-BfifC1He.js" as="script"><link rel="prefetch" href="/assets/MyBatis-Plus.html-B9LAxYYL.js" as="script"><link rel="prefetch" href="/assets/springboot.html-4udt1eEr.js" as="script"><link rel="prefetch" href="/assets/Swagger.html-D6TGnAfe.js" as="script"><link rel="prefetch" href="/assets/README1.html-CwBudAMr.js" as="script"><link rel="prefetch" href="/assets/404.html-D9trWH8C.js" as="script"><link rel="prefetch" href="/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/YihuiLogo.png" alt="忆‌回"><a href="/" class="site-name can-hide">忆‌回</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="主页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->主页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/timeline.html" class="link" aria-label="时间轴"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->时间轴<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/lianxi/1.html" class="link" aria-label="测试"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->测试<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/tags/nvm/1.html" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="练习"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->练习<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="练习"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->练习<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/docs/theme-reco/theme" class="link" aria-label="测试"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->测试<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/other/guide" class="link" aria-label="关于"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->关于<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">Git的安装和使用</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--> 忆﻿回<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025/09/16<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/categories/lianxi/1.html" class="">练习</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/tags/Git/1.html" class="">Git</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h1 id="git-的安装和使用" tabindex="-1"><a class="header-anchor" href="#git-的安装和使用"><span>Git 的安装和使用</span></a></h1><h2 id="_1-什么是git" tabindex="-1"><a class="header-anchor" href="#_1-什么是git"><span>1.什么是Git</span></a></h2><p><strong>Git</strong>是一个开源的分布式版本控制系统，它能够高效地处理从小到大的项目。Git是由Linus Torvalds为了更好地管理Linux内核开发而创造的。与其他常见的版本控制工具如CVS和Subversion不同，Git采用了分布式版本库的方式，这意味着每个工作副本都是一个完整的版本库，不依赖于中央服务器</p><h2 id="_2-安装git" tabindex="-1"><a class="header-anchor" href="#_2-安装git"><span>2.安装Git</span></a></h2><h3 id="_2-1-在windows上安装git" tabindex="-1"><a class="header-anchor" href="#_2-1-在windows上安装git"><span>2.1 在Windows上安装Git</span></a></h3><p>在Windows上使用Git，也有两种安装方法。</p><p>第一种是直接从Git官网直接<a href="https://git-scm.com/downloads/win" target="_blank" rel="noopener noreferrer">下载安装程序<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，然后按默认选项安装即可。安装完成后，在开始菜单里找到“Git”-&gt;“Git Bash”，蹦出一个类似命令行窗口的东西，就说明Git安装成功。</p><p><img src="https://liaoxuefeng.com/books/git/install-git/win.jpg" alt="install-git-on-windows"></p><p>第二种是先安装一个包管理器，推荐<a href="https://scoop.sh/" target="_blank" rel="noopener noreferrer">Scoop<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，然后在PowerShell中通过以下命令安装Git：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">C:\&gt; scoop install git</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>安装完成后，在PowerShell下运行命令<code>git -v</code>显示Git版本，可看到如下输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">┌─────────────────────────────────────────────────────────┐</span>
<span class="line">│Windows PowerShell                                 - □ x │</span>
<span class="line">├─────────────────────────────────────────────────────────┤</span>
<span class="line">│Windows PowerShell                                       │</span>
<span class="line">│Copyright (C) Microsoft Corporation. All rights reserved.│</span>
<span class="line">│                                                         │</span>
<span class="line">│PS C:\Users\liaoxuefeng&gt; git -v                          │</span>
<span class="line">│git version 2.48.1.windows.1                             │</span>
<span class="line">│PS C:\Users\liaoxuefeng&gt;                                 │</span>
<span class="line">│                                                         │</span>
<span class="line">└─────────────────────────────────────────────────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用包管理器安装Git只需一条命令，且升级非常方便。Debian/Ubuntu Linux的APT、macOS的Homebrew、Windows的Scoop在命令行下的安装、升级、卸载命令都是类似的，例如，升级Git，三种包管理器对应的命令分别是：</p><ul><li>sudo apt update git</li><li>brew update git</li><li>scoop update git</li></ul><p>可以说熟悉一种包管理器的用法后，在其他平台也可迅速上手，推荐使用。</p><h3 id="_2-2-配置git" tabindex="-1"><a class="header-anchor" href="#_2-2-配置git"><span>2.2 配置Git</span></a></h3><p>安装好Git后，还需要最后一步设置，在命令行输入：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git config --global user.name &quot;Your Name&quot;</span>
<span class="line">$ git config --global user.email &quot;email@example.com&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/01-BTMDslMa.png"><p>因为Git是分布式版本控制系统，所以，每个机器都必须自报家门：你的名字和Email地址。你也许会担心，如果有人故意冒充别人怎么办？这个不必担心，首先我们相信大家都是善良无知的群众，其次，真的有冒充的也是有办法可查的。</p><blockquote><p>⚠️注意:<code>git config</code>命令的<code>--global</code>参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p></blockquote><h2 id="_3-创建版本库" tabindex="-1"><a class="header-anchor" href="#_3-创建版本库"><span>3.创建版本库</span></a></h2><p>什么是版本库呢？版本库又名仓库（Repository），你可以简单理解成一个目录，这个目录里面的所有文件都可以被Git管理起来，每个文件的修改、删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。</p><p>所以，创建一个版本库非常简单，首先，选择一个合适的地方，创建一个空目录：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ mkdir test</span>
<span class="line">$ cd test</span>
<span class="line">$ pwd</span>
<span class="line">/HBBTJ/test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>pwd</code>命令用于显示当前目录。在我的Mac上，这个仓库位于<code>/Users/michael/learngit</code>。</p><blockquote><p>⚠️注意 : 如果你使用Windows系统，为了避免遇到各种莫名其妙的问题，请确保目录名（包括父目录）不包含中文。</p></blockquote><p>第二步，通过<code>git init</code>命令把这个目录变成Git可以管理的仓库：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git init</span>
<span class="line">Initialized empty Git repository in /Users/michael/learngit/.git/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/02-D7PEwsbA.png"><p>瞬间Git就把仓库建好了，而且告诉你是一个空的仓库（empty Git repository），细心的读者可以发现当前目录下多了一个<code>.git</code>的目录，这个目录是Git来跟踪管理版本库的，没事千万不要手动修改这个目录里面的文件，不然改乱了，就把Git仓库给破坏了。</p><p>如果你没有看到<code>.git</code>目录，那是因为这个目录默认是隐藏的，用<code>ls -ah</code>命令就可以看见。</p><p><strong>把文件添加到版本库</strong></p><p>言归正传，现在我们编写一个<code>readme.txt</code>文件，内容如下：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a version control system.</span>
<span class="line">Git is free software.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/03-sKslS28p.png"><p>一定要放到<code>test</code>目录下（子目录也行），因为这是一个Git仓库，放到其他地方Git再厉害也找不到这个文件。</p><p>和把大象放到冰箱需要3步相比，把一个文件放到Git仓库只需要两步。</p><p>第一步，用命令<code>git add</code>告诉Git，把文件添加到仓库：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>执行上面的命令，没有任何显示，这就对了，Unix的哲学是“没有消息就是好消息”，说明添加成功。</p><p>第二步，用命令<code>git commit</code>告诉Git，把文件提交到仓库：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git commit -m &quot;wrote a readme file&quot;</span>
<span class="line">[master (root-commit) eaadf4e] wrote a readme file</span>
<span class="line"> 1 file changed, 2 insertions(+)</span>
<span class="line"> create mode 100644 readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/04-C1kPWN3A.png"><p>简单解释一下<code>git commit</code>命令，<code>-m</code>后面输入的是本次提交的说明，可以输入任意内容，当然最好是有意义的，这样你就能从历史记录里方便地找到改动记录。</p><p><code>git commit</code>命令执行成功后会告诉你，<code>1 file changed</code>：1个文件被改动（我们新添加的readme.txt文件）；<code>2 insertions</code>：插入了两行内容（readme.txt有两行内容）。</p><p>为什么Git添加文件需要<code>add</code>，<code>commit</code>一共两步呢？因为<code>commit</code>可以一次提交很多文件，所以你可以多次<code>add</code>不同的文件，比如：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add file1.txt</span>
<span class="line">$ git add file2.txt file3.txt</span>
<span class="line">$ git commit -m &quot;add 3 files.&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>小结</strong></p><p>现在总结一下今天学的两点内容：</p><p>初始化一个Git仓库，使用<code>git init</code>命令。</p><p>添加文件到Git仓库，分两步：</p><ol><li>使用命令<code>git add &lt;file&gt;</code>，⚠️注意，可反复多次使用，添加多个文件；</li><li>使用命令<code>git commit -m &lt;message&gt;</code>，完成。</li></ol><h2 id="_4-版本管理" tabindex="-1"><a class="header-anchor" href="#_4-版本管理"><span>4.版本管理</span></a></h2><p>我们已经成功地添加并提交了一个readme.txt文件，现在，是时候继续工作了，于是，我们继续修改readme.txt文件，改成如下内容：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>!<img src="/assets/05-BoeBbASW.png"></p><p>现在，运行<code>git status</code>命令看看结果：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span>
<span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/06-DvI-a4xA.png"><p><code>git status</code>命令可以让我们时刻掌握仓库当前的状态，上面的命令输出告诉我们，<code>readme.txt</code>被修改过了，但还没有准备提交的修改。</p><p>虽然Git告诉我们<code>readme.txt</code>被修改了，但如果能看看具体修改了什么内容，自然是很好的。比如你休假两周从国外回来，第一天上班时，已经记不清上次怎么修改的<code>readme.txt</code>，所以，需要用<code>git diff</code>这个命令看看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git diff readme.txt </span>
<span class="line">diff --git a/readme.txt b/readme.txt</span>
<span class="line">index 46d49bf..9247db6 100644</span>
<span class="line">--- a/readme.txt</span>
<span class="line">+++ b/readme.txt</span>
<span class="line">@@ -1,2 +1,2 @@</span>
<span class="line">-Git is a version control system.</span>
<span class="line">+Git is a distributed version control system.</span>
<span class="line"> Git is free software.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/07-D389XulW.png"><p><code>git diff</code>顾名思义就是查看difference，显示的格式正是Unix通用的diff格式，可以从上面的命令输出看到，我们在第一行添加了一个<code>distributed</code>单词。</p><p>知道了对<code>readme.txt</code>作了什么修改后，再把它提交到仓库就放心多了，提交修改和提交新文件是一样的两步，第一步是<code>git add</code>：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>同样没有任何输出。在执行第二步<code>git commit</code>之前，我们再运行<code>git status</code>看看当前仓库的状态：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes to be committed:</span>
<span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/08-DAT4bFEX.png"><p><code>git status</code>告诉我们，将要被提交的修改包括<code>readme.txt</code>，下一步，就可以放心地提交了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git commit -m &quot;add distributed&quot;</span>
<span class="line">[master e475afc] add distributed</span>
<span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提交后，我们再用<code>git status</code>命令看看仓库的当前状态：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">nothing to commit, working tree clean</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/09-Dqdxqs62.png"> Git告诉我们当前没有需要提交的修改，而且，工作目录是干净（working tree clean）的。 <p><strong>小结</strong></p><ul><li>要随时掌握工作区的状态，使用<code>git status</code>命令。</li><li>如果<code>git status</code>告诉你有文件被修改过，用<code>git diff</code>可以查看修改内容。</li></ul><h3 id="_4-1-版本回退" tabindex="-1"><a class="header-anchor" href="#_4-1-版本回退"><span>4.1 版本回退</span></a></h3><p>现在，你已经学会了修改文件，然后把修改提交到Git版本库，现在，再练习一次，修改readme.txt文件如下：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后尝试提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt</span>
<span class="line">$ git commit -m &quot;append GPL&quot;</span>
<span class="line">[master 1094adb] append GPL</span>
<span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/10-Bw3U_PTK.png"> 现在，我们回顾一下`readme.txt`文件一共有几个版本被提交到Git仓库里了： <p>版本1：wrote a readme file</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a version control system.</span>
<span class="line">Git is free software.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>版本2：add distributed</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>版本3：append GPL</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>版本控制系统肯定有某个命令可以告诉我们历史记录，在Git中，我们用<code>git log</code>命令查看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log</span>
<span class="line">commit 1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -&gt; master)</span>
<span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span>
<span class="line">Date:   Fri May 18 21:06:15 2018 +0800</span>
<span class="line"></span>
<span class="line">    append GPL</span>
<span class="line"></span>
<span class="line">commit e475afc93c209a690c39c13a46716e8fa000c366</span>
<span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span>
<span class="line">Date:   Fri May 18 21:03:36 2018 +0800</span>
<span class="line"></span>
<span class="line">    add distributed</span>
<span class="line"></span>
<span class="line">commit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0</span>
<span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span>
<span class="line">Date:   Fri May 18 20:59:18 2018 +0800</span>
<span class="line"></span>
<span class="line">    wrote a readme file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/11-f6G1JB-U.png"><p><code>git log</code>命令显示从最近到最远的提交日志，我们可以看到3次提交，最近的一次是<code>append GPL</code>，上一次是<code>add distributed</code>，最早的一次是<code>wrote a readme file</code>。</p><p>如果嫌输出信息太多，看得眼花缭乱的，可以试试加上<code>--pretty=oneline</code>参数：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --pretty=oneline</span>
<span class="line">1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -&gt; master) append GPL</span>
<span class="line">e475afc93c209a690c39c13a46716e8fa000c366 add distributed</span>
<span class="line">eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0 wrote a readme file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/12-BBIYGcm6.png"><p>每提交一个新版本，实际上Git就会把它们自动串成一条时间线。如果使用可视化工具查看Git历史，就可以更清楚地看到提交历史的时间线：</p><p>好了，现在我们准备把<code>readme.txt</code>回退到上一个版本，也就是<code>add distributed</code>的那个版本，怎么做呢？</p><p>首先，Git必须知道当前版本是哪个版本，在Git中，用<code>HEAD</code>表示当前版本，也就是最新的提交<code>1094adb...</code>（注意我的提交ID和你的肯定不一样），上一个版本就是<code>HEAD^</code>，上上一个版本就是<code>HEAD^^</code>，当然往上100个版本写100个<code>^</code>比较容易数不过来，所以写成<code>HEAD~100</code>。</p><p>现在，我们要把当前版本<code>append GPL</code>回退到上一个版本<code>add distributed</code>，就可以使用<code>git reset</code>命令：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git reset --hard HEAD^</span>
<span class="line">HEAD is now at e475afc add distributed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>--hard</code>参数有啥意义？<code>--hard</code>会回退到上个版本的已提交状态，而<code>--soft</code>会回退到上个版本的未提交状态，<code>--mixed</code>会回退到上个版本未添加状态,现在，先放心使用<code>--hard</code>。</p><p>看看<code>readme.txt</code>的内容是不是版本<code>add distributed</code>：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat readme.txt</span>
<span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/13-C5QXEg7p.png"><p>果然被还原了。</p><p>还可以继续回退到上一个版本<code>wrote a readme file</code>，不过且慢，让我们用<code>git log</code>再看看现在版本库的状态：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log</span>
<span class="line">commit e475afc93c209a690c39c13a46716e8fa000c366 (HEAD -&gt; master)</span>
<span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span>
<span class="line">Date:   Fri May 18 21:03:36 2018 +0800</span>
<span class="line"></span>
<span class="line">    add distributed</span>
<span class="line"></span>
<span class="line">commit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0</span>
<span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span>
<span class="line">Date:   Fri May 18 20:59:18 2018 +0800</span>
<span class="line"></span>
<span class="line">    wrote a readme file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/14-pqx8uLaK.png"><p>最新的那个版本<code>append GPL</code>已经看不到了！好比你从21世纪坐时光穿梭机来到了19世纪，想再回去已经回不去了，肿么办？</p><p>办法其实还是有的，只要上面的命令行窗口还没有被关掉，你就可以顺着往上找啊找啊，找到那个<code>append GPL</code>的<code>commit id</code>是<code>a5a48b...</code>，于是就可以指定回到未来的某个版本：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git reset --hard a5a48b</span>
<span class="line">HEAD is now at 83b0afe append GPL</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>版本号没必要写全，前几位就可以了，Git会自动去找。当然也不能只写前一两位，因为Git可能会找到多个版本号，就无法确定是哪一个了。</p><p>再小心翼翼地看看<code>readme.txt</code>的内容：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat readme.txt</span>
<span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/15-BKqrmPn2.png"><p>果然，我胡汉三又回来了。</p><p>Git的版本回退速度非常快，因为Git在 内部有个指向当前版本的<code>HEAD</code>指针，当你回退版本的时候，Git仅仅是把HEAD从指向<code>append GPL</code>：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">┌────┐</span>
<span class="line">│HEAD│</span>
<span class="line">└────┘</span>
<span class="line">   │</span>
<span class="line">   └──▶ ○ append GPL</span>
<span class="line">        │</span>
<span class="line">        ○ add distributed</span>
<span class="line">        │</span>
<span class="line">        ○ wrote a readme file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>改为指向<code>add distributed</code>：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">┌────┐</span>
<span class="line">│HEAD│</span>
<span class="line">└────┘</span>
<span class="line">   │</span>
<span class="line">   │    ○ append GPL</span>
<span class="line">   │    │</span>
<span class="line">   └──▶ ○ add distributed</span>
<span class="line">        │</span>
<span class="line">        ○ wrote a readme file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后顺便把工作区的文件更新了。所以你让<code>HEAD</code>指向哪个版本号，你就把当前版本定位在哪。</p><p>当你用<code>$ git reset --hard HEAD^</code>回退到<code>add distributed</code>版本时，再想恢复到<code>append GPL</code>，就必须找到<code>append GPL</code>的commit id。Git提供了一个命令<code>git reflog</code>用来记录你的每一次命令：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git reflog</span>
<span class="line">e475afc HEAD@{1}: reset: moving to HEAD^</span>
<span class="line">1094adb (HEAD -&gt; master) HEAD@{2}: commit: append GPL</span>
<span class="line">e475afc HEAD@{3}: commit: add distributed</span>
<span class="line">eaadf4e HEAD@{4}: commit (initial): wrote a readme file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/16-C-0YFEOy.png"> 从输出可知，`append GPL`的commit id是`a5a48b` <p><strong>小结</strong></p><p>现在总结一下：</p><ul><li><code>HEAD</code>指向的版本就是当前版本，因此，Git允许我们在版本的历史之间穿梭，使用命令<code>git reset --hard commit_id</code>。</li><li>穿梭前，用<code>git log</code>可以查看提交历史，以便确定要回退到哪个版本。</li><li>要重返未来，用<code>git reflog</code>查看命令历史，以便确定要回到未来的哪个版本。</li></ul><h3 id="_4-2-工作区和暂存区" tabindex="-1"><a class="header-anchor" href="#_4-2-工作区和暂存区"><span>4.2 工作区和暂存区</span></a></h3><p><strong>工作区（Working Directory）</strong></p><p>就是你在电脑里能看到的目录。</p><p><strong>版本库（Repository）</strong></p><p>工作区有一个隐藏目录<code>.git</code>，这个不算工作区，而是Git的版本库。</p><p>Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支<code>master</code>，以及指向<code>master</code>的一个指针叫<code>HEAD</code>。</p><p><img src="https://liaoxuefeng.com/books/git/time-travel/working-stage/repo.png" alt="git-repo"></p><p>前面讲了我们把文件往Git版本库里添加的时候，是分两步执行的：</p><p>第一步是用<code>git add</code>把文件添加进去，实际上就是把文件修改添加到暂存区；</p><p>第二步是用<code>git commit</code>提交更改，实际上就是把暂存区的所有内容提交到当前分支。</p><p>因为我们创建Git版本库时，Git自动为我们创建了唯一一个<code>master</code>分支，所以，现在，<code>git commit</code>就是往<code>master</code>分支上提交更改。</p><p>你可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。</p><p>俗话说，实践出真知。现在，我们再练习一遍，先对<code>readme.txt</code>做个修改，比如加上一行内容：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，在工作区新增一个<code>LICENSE</code>文本文件（内容随便写）。</p><p>先用<code>git status</code>查看一下状态：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span>
<span class="line">Untracked files:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span>
<span class="line"></span>
<span class="line">	LICENSE</span>
<span class="line"></span>
<span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/17-BeoX-KOM.png"><p>Git非常清楚地告诉我们，<code>readme.txt</code>被修改了，而<code>LICENSE</code>还从来没有被添加过，所以它的状态是<code>Untracked</code>。</p><p>现在，使用两次命令<code>git add</code>，把<code>readme.txt</code>和<code>LICENSE</code>都添加后，用<code>git status</code>再查看一下：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes to be committed:</span>
<span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="line"></span>
<span class="line">	new file:   LICENSE</span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div> <img src="/assets/18-D1FWcp_I.png"><p>现在，暂存区的状态就变成这样了：</p><p><img src="https://liaoxuefeng.com/books/git/time-travel/working-stage/add.png" alt="git-stage"></p><p>所以，<code>git add</code>命令实际上就是把要提交的所有修改放到暂存区（Stage），然后，执行<code>git commit</code>就可以一次性把暂存区的所有修改提交到分支。</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git commit -m &quot;understand how stage works&quot;</span>
<span class="line">[master e43a48b] understand how stage works</span>
<span class="line"> 2 files changed, 2 insertions(+)</span>
<span class="line"> create mode 100644 LICENSE</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一旦提交后，如果你又没有对工作区做任何修改，那么工作区就是“干净”的：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">nothing to commit, working tree clean</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/19-YswCAcj7.png"><p>现在版本库变成了这样，暂存区就没有任何内容了：</p><p><img src="https://liaoxuefeng.com/books/git/time-travel/working-stage/commit.png" alt="git-stage-after-commit"></p><h3 id="_4-3-管理修改" tabindex="-1"><a class="header-anchor" href="#_4-3-管理修改"><span>4.3 管理修改</span></a></h3><p>什么是修改？比如你新增了一行，这就是一个修改，删除了一行，也是一个修改，更改了某些字符，也是一个修改，删了一些又加了一些，也是一个修改，甚至创建一个新文件，也算一个修改。</p><p>为什么说Git管理的是修改，而不是文件呢？我们还是做实验。第一步，对readme.txt做一个修改，比如加一行内容：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat readme.txt</span>
<span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line">Git tracks changes.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，添加：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt</span>
<span class="line">$ git status</span>
<span class="line"># On branch master</span>
<span class="line"># Changes to be committed:</span>
<span class="line">#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="line">#</span>
<span class="line">#       modified:   readme.txt</span>
<span class="line">#</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，再修改readme.txt：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat readme.txt </span>
<span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line">Git tracks changes of files.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git commit -m &quot;git tracks changes&quot;</span>
<span class="line">[master 519219b] git tracks changes</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提交后，再看看状态：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span>
<span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/20-Do6g7GGV.png"><p>咦，怎么第二次的修改没有被提交？</p><p>第一次修改 -&gt; <code>git add</code> -&gt; 第二次修改 -&gt; <code>git commit</code></p><p>你看，我们前面讲了，Git管理的是修改，当你用<code>git add</code>命令后，在工作区的第一次修改被放入暂存区，准备提交，但是，在工作区的第二次修改并没有放入暂存区，所以，<code>git commit</code>只负责把暂存区的修改提交了，也就是第一次的修改被提交了，第二次的修改不会被提交。</p><p>提交后，用<code>git diff HEAD -- readme.txt</code>命令可以查看工作区和版本库里面最新版本的区别：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git diff HEAD -- readme.txt </span>
<span class="line">diff --git a/readme.txt b/readme.txt</span>
<span class="line">index 76d770f..a9c5755 100644</span>
<span class="line">--- a/readme.txt</span>
<span class="line">+++ b/readme.txt</span>
<span class="line">@@ -1,4 +1,4 @@</span>
<span class="line"> Git is a distributed version control system.</span>
<span class="line"> Git is free software distributed under the GPL.</span>
<span class="line"> Git has a mutable index called stage.</span>
<span class="line">-Git tracks changes.</span>
<span class="line">+Git tracks changes of files.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/21-Rh9XcBCY.png"><p>可见，第二次修改确实没有被提交。那怎么提交第二次修改呢？你可以继续<code>git add</code>再<code>git commit</code>，也可以别着急提交第一次修改，先<code>git add</code>第二次修改，再<code>git commit</code>，就相当于把两次修改合并后一块提交了：</p><p>第一次修改 -&gt; <code>git add</code> -&gt; 第二次修改 -&gt; <code>git add</code> -&gt; <code>git commit</code></p><p><strong>小结</strong></p><p>每次修改，如果不用<code>git add</code>到暂存区，那就不会加入到<code>commit</code>中。</p><h3 id="_4-4-撤销修改" tabindex="-1"><a class="header-anchor" href="#_4-4-撤销修改"><span>4.4 撤销修改</span></a></h3><p>自然，你是不会犯错的。不过现在是凌晨两点，你正在赶一份工作报告，你在<code>readme.txt</code>中添加了一行：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat readme.txt</span>
<span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line">Git tracks changes of files.</span>
<span class="line">My stupid boss still prefers SVN.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在你准备提交前，一杯咖啡起了作用，你猛然发现了<code>stupid boss</code>可能会让你丢掉这个月的奖金！</p><p>既然错误发现得很及时，就可以很容易地纠正它。你可以删掉最后一行，手动把文件恢复到上一个版本的状态。如果用<code>git status</code>查看一下：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span>
<span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你可以发现，Git会告诉你，<code>git checkout -- file</code>可以丢弃工作区的修改：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git checkout -- readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>命令<code>git checkout -- readme.txt</code>意思就是，把<code>readme.txt</code>文件在工作区的修改全部撤销，这里有两种情况：</p><p>一种是<code>readme.txt</code>自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态；</p><p>一种是<code>readme.txt</code>已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。</p><p>总之，就是让这个文件回到最近一次<code>git commit</code>或<code>git add</code>时的状态。</p><p>现在，看看<code>readme.txt</code>的文件内容：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat readme.txt</span>
<span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line">Git tracks changes of files.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/22-C1gpRCbK.png"><p>文件内容果然复原了。</p><p><code>git checkout -- file</code>命令中的<code>--</code>很重要，没有<code>--</code>，就变成了“切换到另一个分支”的命令，我们在后面的分支管理中会再次遇到<code>git checkout</code>命令。</p><p>现在假定是凌晨3点，你不但写了一些胡话，还<code>git add</code>到暂存区了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat readme.txt</span>
<span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line">Git tracks changes of files.</span>
<span class="line">My stupid boss still prefers SVN.</span>
<span class="line"></span>
<span class="line">$ git add readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>庆幸的是，在<code>commit</code>之前，你发现了这个问题。用<code>git status</code>查看一下，修改只是添加到了暂存区，还没有提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes to be committed:</span>
<span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Git同样告诉我们，用命令<code>git reset HEAD &lt;file&gt;</code>可以把暂存区的修改撤销掉（unstage），重新放回工作区：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git reset HEAD readme.txt</span>
<span class="line">Unstaged changes after reset:</span>
<span class="line">M	readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>git reset</code>命令既可以回退版本，也可以把暂存区的修改回退到工作区。当我们用<code>HEAD</code>时，表示最新的版本。</p><p>再用<code>git status</code>查看一下，现在暂存区是干净的，工作区有修改：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还记得如何丢弃工作区的修改吗？</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git checkout -- readme.txt</span>
<span class="line"></span>
<span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">nothing to commit, working tree clean</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/23-_LwkJY7b.png"><p>整个世界终于清静了！</p><p>现在，假设你不但改错了东西，还从暂存区提交到了版本库，怎么办呢？还记得<a href="https://liaoxuefeng.com/books/git/time-travel/reset/index.html" target="_blank" rel="noopener noreferrer">版本回退<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>一节吗？可以回退到上一个版本。不过，这是有条件的，就是你还没有把自己的本地版本库推送到远程。还记得Git是分布式版本控制系统吗？我们后面会讲到远程版本库，一旦你把<code>stupid boss</code>提交推送到远程版本库，你就真的惨了……</p><p><strong>小结</strong></p><p>又到了小结时间。</p><p>场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令<code>git checkout -- file</code>。</p><p>场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令<code>git reset HEAD &lt;file&gt;</code>，就回到了场景1，第二步按场景1操作。</p><p>场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考<a href="https://liaoxuefeng.com/books/git/time-travel/reset/index.html" target="_blank" rel="noopener noreferrer">版本回退<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>一节，不过前提是没有推送到远程库。</p><h3 id="_4-5-删除文件" tabindex="-1"><a class="header-anchor" href="#_4-5-删除文件"><span>4.5 删除文件</span></a></h3><p>在Git中，删除也是一个修改操作，我们实战一下，先添加一个新文件<code>test.txt</code>到Git并且提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add test.txt</span>
<span class="line"></span>
<span class="line">$ git commit -m &quot;add test.txt&quot;</span>
<span class="line">[master b84166e] add test.txt</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"> create mode 100644 test.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一般情况下，你通常直接在文件管理器中把没用的文件删了，或者用<code>rm</code>命令删了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ rm test.txt  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个时候，Git知道你删除了文件，因此，工作区和版本库就不一致了，<code>git status</code>命令会立刻告诉你哪些文件被删除了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add/rm &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	deleted:    test.txt</span>
<span class="line"></span>
<span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/24-B6aXSMTf.png"><p>现在你有两个选择，一是确实要从版本库中删除该文件，那就用命令<code>git rm</code>删掉，并且<code>git commit</code>：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git rm test.txt</span>
<span class="line">rm &#39;test.txt&#39;</span>
<span class="line"></span>
<span class="line">$ git commit -m &quot;remove test.txt&quot;</span>
<span class="line">[master d46f35e] remove test.txt</span>
<span class="line"> 1 file changed, 1 deletion(-)</span>
<span class="line"> delete mode 100644 test.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/25-CUcPB0Ty.png"><p>现在，文件就从版本库中被删除了。</p><p>先手动删除文件，然后使用<code>git rm &lt;file&gt;</code>和<code>git add&lt;file&gt;</code>效果是一样的。</p><p>另一种情况是删错了，因为版本库里还有呢，所以可以很轻松地把误删的文件恢复到最新版本：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git checkout -- test.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>git checkout</code>其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。</p><blockquote><p>⚠️注意:</p><p>从来没有被添加到版本库就被删除的文件，是无法恢复的！</p></blockquote><p><strong>小结</strong></p><p>命令<code>git rm</code>用于删除一个文件。如果一个文件已经被提交到版本库，那么你永远不用担心误删，但是要小心，你只能恢复文件到最新版本，你会丢失<strong>最近一次提交后你修改的内容</strong>。</p><h2 id="_5-远程仓库" tabindex="-1"><a class="header-anchor" href="#_5-远程仓库"><span>5.远程仓库</span></a></h2><h3 id="使用guthub" tabindex="-1"><a class="header-anchor" href="#使用guthub"><span>使用GutHub</span></a></h3><p>Git是分布式版本控制系统，同一个Git仓库，可以分布到不同的机器上。怎么分布呢？最早，肯定只有一台机器有一个原始版本库，此后，别的机器可以“克隆”这个原始版本库，而且每台机器的版本库其实都是一样的，并没有主次之分。</p><p>在继续阅读后续内容前，请自行注册GitHub账号。由于你的本地Git仓库和GitHub仓库之间的传输是通过SSH加密的，所以，需要一点设置：</p><p>第1步：创建SSH Key。在用户主目录下，看看有没有.ssh目录，如果有，再看看这个目录下有没有<code>id_rsa</code>和<code>id_rsa.pub</code>这两个文件，如果已经有了，可直接跳到下一步。如果没有，打开Shell（Windows下打开Git Bash），创建SSH Key：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你需要把邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可，由于这个Key也不是用于军事目的，所以也无需设置密码。</p><p>如果一切顺利的话，可以在用户主目录里找到<code>.ssh</code>目录，里面有<code>id_rsa</code>和<code>id_rsa.pub</code>两个文件，这两个就是SSH Key的秘钥对，<code>id_rsa</code>是私钥，不能泄露出去，<code>id_rsa.pub</code>是公钥，可以放心地告诉任何人。</p><p>第2步：登陆GitHub，打开“Account settings”，“SSH Keys”页面：</p><p>然后，点“Add SSH Key”，填上任意Title，在Key文本框里粘贴<code>id_rsa.pub</code>文件的内容：</p><p><img src="https://liaoxuefeng.com/books/git/remote/add-key.png" alt="github-addkey-1"></p><p>点“Add Key”，你就应该看到已经添加的Key：</p><p><img src="https://liaoxuefeng.com/books/git/remote/keys.png" alt="github-addkey-2"></p><p>为什么GitHub需要SSH Key呢？因为GitHub需要识别出你推送的提交确实是你推送的，而不是别人冒充的，而Git支持SSH协议，所以，GitHub只要知道了你的公钥，就可以确认只有你自己才能推送。</p><p>当然，GitHub允许你添加多个Key。假定你有若干电脑，你一会儿在公司提交，一会儿在家里提交，只要把每台电脑的Key都添加到GitHub，就可以在每台电脑上往GitHub推送了。</p><blockquote><p>⚠️注意:</p><p>在GitHub上免费托管的Git仓库，任何人都可以看到,但只有你自己才能改,不要把敏感信息放进去。</p></blockquote><p>如果你不想让别人看到Git库，有两个办法，一个是交点保护费，让GitHub把公开的仓库变成私有的，这样别人就看不见了（不可读更不可写）。另一个办法是自己动手，搭一个Git服务器，因为是你自己的Git服务器，所以别人也是看不见的。这个方法我们后面会讲到的，相当简单，公司内部开发必备。</p><h3 id="使用gitee" tabindex="-1"><a class="header-anchor" href="#使用gitee"><span>使用Gitee</span></a></h3><p>使用GitHub时，国内的用户经常遇到的问题是访问速度太慢，有时候还会出现无法连接的情况（原因你懂的）。</p><p>如果我们希望体验Git飞一般的速度，可以使用国内的Git托管服务——<a href="https://gitee.com/?utm_source=blog_lxf" target="_blank" rel="noopener noreferrer">Gitee<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（<a href="https://gitee.com/?utm_source=blog_lxf" target="_blank" rel="noopener noreferrer">gitee.com<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）。</p><p>和GitHub相比，Gitee也提供免费的Git仓库。此外，还集成了代码质量检测、项目演示等功能。对于团队协作开发，Gitee还提供了项目管理、代码托管、文档管理的服务，5人以下小团队免费。</p><p>注意</p><p>Gitee的免费版本也提供私有库功能，只是有5人的成员上限。</p><p>Gitee 企业版专属购买通道</p><p>&gt;&gt; <a href="https://gitee.com/enterprises?utm_source=lxf" target="_blank" rel="noopener noreferrer">Gitee企业版专属购买通道<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> &lt;&lt;</p><p>使用Gitee和使用GitHub类似，我们在Gitee上注册账号并登录后，需要先上传自己的SSH公钥。选择右上角用户头像 -&gt; 菜单“设置”，然后在左侧菜单选择“SSH公钥”，填写一个便于识别的标题，然后把用户主目录下的<code>.ssh/id_rsa.pub</code>文件的内容粘贴进去：</p><p><img src="https://liaoxuefeng.com/books/git/gitee/add-key.png" alt="gitee-add-ssh-key"></p><p>点击“确定”即可完成并看到刚才添加的Key：</p><p><img src="https://liaoxuefeng.com/books/git/gitee/keys.png" alt="gitee-key"></p><img src="/assets/26-Dy8oaA29.png"><h3 id="_5-1-添加远程库" tabindex="-1"><a class="header-anchor" href="#_5-1-添加远程库"><span>5.1 添加远程库</span></a></h3><p>如果我们已经有了一个本地的git仓库（例如，一个名为learngit的本地库），如何把它关联到Gitee的远程库上呢？</p><p>首先，我们在Gitee上创建一个新的项目，选择右上角用户头像旁的加号，然后点击“新建仓库”：</p><p><img src="https://liaoxuefeng.com/books/git/gitee/create-repo.png" alt="gitee-new-repo"></p><p>项目名称最好与本地库保持一致。</p><p>然后，我们在本地库上使用命令<code>git remote add</code>把它和Gitee的远程库关联：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git remote add origin git@gitee.com:liaoxuefeng/learngit.git</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>之后，就可以正常地用<code>git push</code>和<code>git pull</code>推送了！</p><p>如果在使用命令<code>git remote add</code>时报错：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">git remote add origin git@gitee.com:liaoxuefeng/learngit.git</span>
<span class="line">fatal: remote origin already exists.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这说明本地库已经关联了一个名叫<code>origin</code>的远程库，此时，可以先用<code>git remote -v</code>查看远程库信息：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">git remote -v</span>
<span class="line">origin	git@github.com:michaelliao/learngit.git (fetch)</span>
<span class="line">origin	git@github.com:michaelliao/learngit.git (push)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/27-RnZHlI5P.png"><p>可以看到，本地库已经关联了<code>origin</code>的远程库，并且，该远程库指向GitHub。</p><p>我们可以删除已有的GitHub远程库：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">git remote rm origin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>再关联Gitee的远程库（注意路径中需要填写正确的用户名）：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">git remote add origin git@gitee.com:liaoxuefeng/learngit.git</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>此时，我们再查看远程库信息：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">git remote -v</span>
<span class="line">origin	git@gitee.com:liaoxuefeng/learngit.git (fetch)</span>
<span class="line">origin	git@gitee.com:liaoxuefeng/learngit.git (push)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/28-gjhmErWK.png"><p>现在可以看到，origin已经被关联到Gitee的远程库了。通过<code>git push</code>命令就可以把本地库推送到Gitee上。</p><p><strong>小结</strong></p><p>要关联一个远程库，使用命令<code>git remote add origin git@server-name:path/repo-name.git</code>；</p><p>关联一个远程库时必须给远程库指定一个名字，<code>origin</code>是默认习惯命名；</p><p>关联后，使用命令<code>git push -u origin master</code>第一次推送<code>master</code>分支的所有内容；</p><p>此后，每次本地提交后，只要有必要，就可以使用命令<code>git push origin master</code>推送最新修改；</p><h3 id="_5-2-从远程库克隆" tabindex="-1"><a class="header-anchor" href="#_5-2-从远程库克隆"><span>5.2 从远程库克隆</span></a></h3><p>上次我们讲了先有本地库，后有远程库的时候，如何关联远程库。</p><p>现在，假设我们从零开发，那么最好的方式是先创建远程库，然后，从远程库克隆。</p><p>首先，登陆GitHub，创建一个新的仓库，名字叫<code>gitskills</code>：</p><p><img src="https://liaoxuefeng.com/books/git/remote/clone/create-repo.png" alt="github-init-repo"></p><p>我们勾选<code>Initialize this repository with a README</code>，这样GitHub会自动为我们创建一个<code>README.md</code>文件。创建完毕后，可以看到<code>README.md</code>文件：</p><p><img src="https://liaoxuefeng.com/books/git/remote/clone/repo-content.png" alt="github-init-repo-2"></p><p>现在，远程库已经准备好了，下一步是用命令<code>git clone</code>克隆一个本地库：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git clone git@github.com:michaelliao/gitskills.git</span>
<span class="line">Cloning into &#39;gitskills&#39;...</span>
<span class="line">remote: Counting objects: 3, done.</span>
<span class="line">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 3</span>
<span class="line">Receiving objects: 100% (3/3), done.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/29-CDLrxBEU.png"><p>注意把Git库的地址换成你自己的，然后进入<code>gitskills</code>目录看看，已经有<code>README.md</code>文件了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cd gitskills</span>
<span class="line">$ ls</span>
<span class="line">README.md</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果有多个人协作开发，那么每个人各自从远程克隆一份就可以了。</p><p>你也许还注意到，GitHub给出的地址不止一个，还可以用<code>https://github.com/michaelliao/gitskills.git</code>这样的地址。实际上，Git支持多种协议，默认的<code>git://</code>使用<code>ssh</code>，但也可以使用<code>https</code>等其他协议。</p><p>使用<code>https</code>除了速度慢以外，还有个最大的麻烦是每次推送都必须输入口令，但是在某些只开放<code>http</code>端口的公司内部就无法使用<code>ssh</code>协议而只能用<code>https</code>。</p><h2 id="_6-分支管理" tabindex="-1"><a class="header-anchor" href="#_6-分支管理"><span>6.分支管理</span></a></h2><p>分支在实际中有什么用呢？假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。</p><p>现在有了分支，就不用怕了。你创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。</p><p>其他版本控制系统如SVN等都有分支管理，但是用过之后你会发现，这些版本控制系统创建和切换分支比蜗牛还慢，简直让人无法忍受，结果分支功能成了摆设，大家都不去用。</p><p>但Git的分支是与众不同的，无论创建、切换和删除分支，Git在1秒钟之内就能完成！无论你的版本库是1个文件还是1万个文件。</p><h3 id="_6-1-创建与合并分支" tabindex="-1"><a class="header-anchor" href="#_6-1-创建与合并分支"><span>6.1 创建与合并分支</span></a></h3><p>在<a href="https://liaoxuefeng.com/books/git/time-travel/reset/index.html" target="_blank" rel="noopener noreferrer">版本回退<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>里，你已经知道，每次提交，Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即<code>master</code>分支。<code>HEAD</code>严格来说不是指向提交，而是指向<code>master</code>，<code>master</code>才是指向提交的，所以，<code>HEAD</code>指向的就是当前分支。</p><p>一开始的时候，<code>master</code>分支是一条线，Git用<code>master</code>指向最新的提交，再用<code>HEAD</code>指向<code>master</code>，就能确定当前分支，以及当前分支的提交点：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                  HEAD</span>
<span class="line">                    │</span>
<span class="line">                    ▼</span>
<span class="line">                 master</span>
<span class="line">                    │</span>
<span class="line">                    ▼</span>
<span class="line">┌───┐    ┌───┐    ┌───┐</span>
<span class="line">│   │───▶│   │───▶│   │</span>
<span class="line">└───┘    └───┘    └───┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每次提交，<code>master</code>分支都会向前移动一步，这样，随着你不断提交，<code>master</code>分支的线也越来越长。</p><p>当我们创建新的分支，例如<code>dev</code>时，Git新建了一个指针叫<code>dev</code>，指向<code>master</code>相同的提交，再把<code>HEAD</code>指向<code>dev</code>，就表示当前分支在<code>dev</code>上：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                 master</span>
<span class="line">                    │</span>
<span class="line">                    ▼</span>
<span class="line">┌───┐    ┌───┐    ┌───┐</span>
<span class="line">│   │───▶│   │───▶│   │</span>
<span class="line">└───┘    └───┘    └───┘</span>
<span class="line">                    ▲</span>
<span class="line">                    │</span>
<span class="line">                   dev</span>
<span class="line">                    ▲</span>
<span class="line">                    │</span>
<span class="line">                  HEAD</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你看，Git创建一个分支很快，因为除了增加一个<code>dev</code>指针，改改<code>HEAD</code>的指向，工作区的文件都没有任何变化！</p><p>不过，从现在开始，对工作区的修改和提交就是针对<code>dev</code>分支了，比如新提交一次后，<code>dev</code>指针往前移动一步，而<code>master</code>指针不变：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                 master</span>
<span class="line">                    │</span>
<span class="line">                    ▼</span>
<span class="line">┌───┐    ┌───┐    ┌───┐    ┌───┐</span>
<span class="line">│   │───▶│   │───▶│   │───▶│   │</span>
<span class="line">└───┘    └───┘    └───┘    └───┘</span>
<span class="line">                             ▲</span>
<span class="line">                             │</span>
<span class="line">                            dev</span>
<span class="line">                             ▲</span>
<span class="line">                             │</span>
<span class="line">                           HEAD</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>假如我们在<code>dev</code>上的工作完成了，就可以把<code>dev</code>合并到<code>master</code>上。Git怎么合并呢？最简单的方法，就是直接把<code>master</code>指向<code>dev</code>的当前提交，就完成了合并：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                           HEAD</span>
<span class="line">                             │</span>
<span class="line">                             ▼</span>
<span class="line">                          master</span>
<span class="line">                             │</span>
<span class="line">                             ▼</span>
<span class="line">┌───┐    ┌───┐    ┌───┐    ┌───┐</span>
<span class="line">│   │───▶│   │───▶│   │───▶│   │</span>
<span class="line">└───┘    └───┘    └───┘    └───┘</span>
<span class="line">                             ▲</span>
<span class="line">                             │</span>
<span class="line">                            dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以Git合并分支也很快！就改改指针，工作区内容也不变！</p><p>合并完分支后，甚至可以删除<code>dev</code>分支。删除<code>dev</code>分支就是把<code>dev</code>指针给删掉，删掉后，我们就剩下了一条<code>master</code>分支：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                           HEAD</span>
<span class="line">                             │</span>
<span class="line">                             ▼</span>
<span class="line">                          master</span>
<span class="line">                             │</span>
<span class="line">                             ▼</span>
<span class="line">┌───┐    ┌───┐    ┌───┐    ┌───┐</span>
<span class="line">│   │───▶│   │───▶│   │───▶│   │</span>
<span class="line">└───┘    └───┘    └───┘    └───┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>真是太神奇了，你看得出来有些提交是通过分支完成的吗？</p><p>下面开始实战。</p><p>首先，我们创建<code>dev</code>分支，然后切换到<code>dev</code>分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git checkout -b dev</span>
<span class="line">Switched to a new branch &#39;dev&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>git checkout</code>命令加上<code>-b</code>参数表示创建并切换，相当于以下两条命令：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch dev</span>
<span class="line">$ git checkout dev</span>
<span class="line">Switched to branch &#39;dev&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，用<code>git branch</code>命令查看当前分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch</span>
<span class="line">* dev</span>
<span class="line">  master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/31-CunQHD-O.png"><p><code>git branch</code>命令会列出所有分支，当前分支前面会标一个<code>*</code>号。</p><p>然后，我们就可以在<code>dev</code>分支上正常提交，比如对<code>readme.txt</code>做个修改，加上一行：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Creating a new branch is quick.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt </span>
<span class="line">$ git commit -m &quot;branch test&quot;</span>
<span class="line">[dev b17d20e] branch test</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，<code>dev</code>分支的工作完成，我们就可以切换回<code>master</code>分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git checkout master</span>
<span class="line">Switched to branch &#39;master&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>切换回<code>master</code>分支后，再查看一个<code>readme.txt</code>文件，刚才添加的内容不见了！因为那个提交是在<code>dev</code>分支上，而<code>master</code>分支此刻的提交点并没有变：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                  HEAD</span>
<span class="line">                    │</span>
<span class="line">                    ▼</span>
<span class="line">                 master</span>
<span class="line">                    │</span>
<span class="line">                    ▼</span>
<span class="line">┌───┐    ┌───┐    ┌───┐    ┌───┐</span>
<span class="line">│   │───▶│   │───▶│   │───▶│   │</span>
<span class="line">└───┘    └───┘    └───┘    └───┘</span>
<span class="line">                             ▲</span>
<span class="line">                             │</span>
<span class="line">                            dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，我们把<code>dev</code>分支的工作成果合并到<code>master</code>分支上：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git merge dev</span>
<span class="line">Updating d46f35e..b17d20e</span>
<span class="line">Fast-forward</span>
<span class="line"> readme.txt | 1 +</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/32-C2mIB86p.png"><p><code>git merge</code>命令用于合并指定分支到当前分支。合并后，再查看<code>readme.txt</code>的内容，就可以看到，和<code>dev</code>分支的最新提交是完全一样的。</p><p>注意到上面的<code>Fast-forward</code>信息，Git告诉我们，这次合并是“快进模式”，也就是直接把<code>master</code>指向<code>dev</code>的当前提交，所以合并速度非常快。</p><p>当然，也不是每次合并都能<code>Fast-forward</code>，我们后面会讲其他方式的合并。</p><p>合并完成后，就可以放心地删除<code>dev</code>分支了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch -d dev</span>
<span class="line">Deleted branch dev (was b17d20e).</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>删除后，查看<code>branch</code>，就只剩下<code>master</code>分支了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch</span>
<span class="line">* master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/33-BX0lXlnu.png"><p>因为创建、合并和删除分支非常快，所以Git鼓励你使用分支完成某个任务，合并后再删掉分支，这和直接在<code>master</code>分支上工作效果是一样的，但过程更安全。</p><p>我们注意到切换分支使用<code>git checkout &lt;branch&gt;</code>，而前面讲过的撤销修改则是<code>git checkout -- &lt;file&gt;</code>，同一个命令，有两种作用，确实有点令人迷惑。</p><p>实际上，切换分支这个动作，用<code>switch</code>更科学。因此，最新版本的Git提供了新的<code>git switch</code>命令来切换分支：</p><p>创建并切换到新的<code>dev</code>分支，可以使用：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch -c dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>直接切换到已有的<code>master</code>分支，可以使用：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="/assets/34-D7kQJb3f.png"><p>使用新的<code>git switch</code>命令，比<code>git checkout</code>要更容易理解。</p><p><strong>小结</strong></p><p>Git鼓励大量使用分支：</p><p>查看分支：<code>git branch</code></p><p>创建分支：<code>git branch &lt;name&gt;</code></p><p>切换分支：<code>git checkout &lt;name&gt;</code>或者<code>git switch &lt;name&gt;</code></p><p>创建+切换分支：<code>git checkout -b &lt;name&gt;</code>或者<code>git switch -c &lt;name&gt;</code></p><p>合并某分支到当前分支：<code>git merge &lt;name&gt;</code></p><p>删除分支：<code>git branch -d &lt;name&gt;</code></p><h3 id="_6-2-解决冲突" tabindex="-1"><a class="header-anchor" href="#_6-2-解决冲突"><span>6.2 解决冲突</span></a></h3><p>准备新的<code>feature1</code>分支，继续我们的新分支开发：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch -c feature1</span>
<span class="line">Switched to a new branch &#39;feature1&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>修改<code>readme.txt</code>最后一行，改为：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Creating a new branch is quick AND simple.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在<code>feature1</code>分支上提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt</span>
<span class="line"></span>
<span class="line">$ git commit -m &quot;AND simple&quot;</span>
<span class="line">[feature1 14096d0] AND simple</span>
<span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/35-EP3q4cF0.png"><p>切换到<code>master</code>分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch master</span>
<span class="line">Switched to branch &#39;master&#39;</span>
<span class="line">Your branch is ahead of &#39;origin/master&#39; by 1 commit.</span>
<span class="line">  (use &quot;git push&quot; to publish your local commits)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Git还会自动提示我们当前<code>master</code>分支比远程的<code>master</code>分支要超前1个提交。</p><p>在<code>master</code>分支上把<code>readme.txt</code>文件的最后一行改为：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Creating a new branch is quick &amp; simple.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt </span>
<span class="line">$ git commit -m &quot;&amp; simple&quot;</span>
<span class="line">[master 5dc6824] &amp; simple</span>
<span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/36-CtBlvWaB.png"><p>现在，<code>master</code>分支和<code>feature1</code>分支各自都分别有新的提交，变成了这样：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                            HEAD</span>
<span class="line">                              │</span>
<span class="line">                              ▼</span>
<span class="line">                           master</span>
<span class="line">                              │</span>
<span class="line">                              ▼</span>
<span class="line">                            ┌───┐</span>
<span class="line">                         ┌─▶│   │</span>
<span class="line">┌───┐    ┌───┐    ┌───┐  │  └───┘</span>
<span class="line">│   │───▶│   │───▶│   │──┤</span>
<span class="line">└───┘    └───┘    └───┘  │  ┌───┐</span>
<span class="line">                         └─▶│   │</span>
<span class="line">                            └───┘</span>
<span class="line">                              ▲</span>
<span class="line">                              │</span>
<span class="line">                          feature1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种情况下，Git无法执行“快速合并”，只能试图把各自的修改合并起来，但这种合并就可能会有冲突，我们试试看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git merge feature1</span>
<span class="line">Auto-merging readme.txt</span>
<span class="line">CONFLICT (content): Merge conflict in readme.txt</span>
<span class="line">Automatic merge failed; fix conflicts and then commit the result.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>果然冲突了！Git告诉我们，<code>readme.txt</code>文件存在冲突，必须手动解决冲突后再提交。<code>git status</code>也可以告诉我们冲突的文件：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Your branch is ahead of &#39;origin/master&#39; by 2 commits.</span>
<span class="line">  (use &quot;git push&quot; to publish your local commits)</span>
<span class="line"></span>
<span class="line">You have unmerged paths.</span>
<span class="line">  (fix conflicts and run &quot;git commit&quot;)</span>
<span class="line">  (use &quot;git merge --abort&quot; to abort the merge)</span>
<span class="line"></span>
<span class="line">Unmerged paths:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to mark resolution)</span>
<span class="line"></span>
<span class="line">	both modified:   readme.txt</span>
<span class="line"></span>
<span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/37-Du5YG4dF.png"><p>我们可以直接查看readme.txt的内容：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line">Git tracks changes of files.</span>
<span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span>
<span class="line">Creating a new branch is quick &amp; simple.</span>
<span class="line">=======</span>
<span class="line">Creating a new branch is quick AND simple.</span>
<span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Git用<code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>，<code>=======</code>，<code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code>标记出不同分支的内容，我们修改如下后保存：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Git is a distributed version control system.</span>
<span class="line">Git is free software distributed under the GPL.</span>
<span class="line">Git has a mutable index called stage.</span>
<span class="line">Git tracks changes of files.</span>
<span class="line">Creating a new branch is quick and simple.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt </span>
<span class="line">$ git commit -m &quot;conflict fixed&quot;</span>
<span class="line">[master cf810e4] conflict fixed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，<code>master</code>分支和<code>feature1</code>分支变成了下图所示：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                                     HEAD</span>
<span class="line">                                       │</span>
<span class="line">                                       ▼</span>
<span class="line">                                    master</span>
<span class="line">                                       │</span>
<span class="line">                                       ▼</span>
<span class="line">                            ┌───┐    ┌───┐</span>
<span class="line">                         ┌─▶│   │───▶│   │</span>
<span class="line">┌───┐    ┌───┐    ┌───┐  │  └───┘    └───┘</span>
<span class="line">│   │───▶│   │───▶│   │──┤             ▲</span>
<span class="line">└───┘    └───┘    └───┘  │  ┌───┐      │</span>
<span class="line">                         └─▶│   │──────┘</span>
<span class="line">                            └───┘</span>
<span class="line">                              ▲</span>
<span class="line">                              │</span>
<span class="line">                          feature1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用带参数的<code>git log</code>也可以看到分支的合并情况：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span>
<span class="line">*   cf810e4 (HEAD -&gt; master) conflict fixed</span>
<span class="line">|\  </span>
<span class="line">| * 14096d0 (feature1) AND simple</span>
<span class="line">* | 5dc6824 &amp; simple</span>
<span class="line">|/  </span>
<span class="line">* b17d20e branch test</span>
<span class="line">* d46f35e (origin/master) remove test.txt</span>
<span class="line">* b84166e add test.txt</span>
<span class="line">* 519219b git tracks changes</span>
<span class="line">* e43a48b understand how stage works</span>
<span class="line">* 1094adb append GPL</span>
<span class="line">* e475afc add distributed</span>
<span class="line">* eaadf4e wrote a readme file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/38-DdBE94zO.png"><p>最后，删除<code>feature1</code>分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch -d feature1</span>
<span class="line">Deleted branch feature1 (was 14096d0).</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>工作完成。</p><p><strong>小结</strong></p><p>当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。</p><p>解决冲突就是把Git合并失败的文件手动编辑为我们希望的内容，再提交。</p><p>用<code>git log --graph</code>命令可以看到分支合并图。</p><h3 id="_6-3-分支管理策略" tabindex="-1"><a class="header-anchor" href="#_6-3-分支管理策略"><span>6.3 分支管理策略</span></a></h3><p>通常，合并分支时，如果可能，Git会用<code>Fast forward</code>模式，但这种模式下，删除分支后，会丢掉分支信息。</p><p>如果要强制禁用<code>Fast forward</code>模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息。</p><p>下面我们实战一下<code>--no-ff</code>方式的<code>git merge</code>：</p><p>首先，仍然创建并切换<code>dev</code>分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch -c dev</span>
<span class="line">Switched to a new branch &#39;dev&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>修改readme.txt文件，并提交一个新的commit：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt </span>
<span class="line">$ git commit -m &quot;add merge&quot;</span>
<span class="line">[dev f52c633] add merge</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，我们切换回<code>master</code>：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch master</span>
<span class="line">Switched to branch &#39;master&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>准备合并<code>dev</code>分支，请注意<code>--no-ff</code>参数，表示禁用<code>Fast forward</code>：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git merge --no-ff -m &quot;merge with no-ff&quot; dev</span>
<span class="line">Merge made by the &#39;recursive&#39; strategy.</span>
<span class="line"> readme.txt | 1 +</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为本次合并要创建一个新的commit，所以加上<code>-m</code>参数，把commit描述写进去。</p><p>合并后，我们用<code>git log</code>看看分支历史：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span>
<span class="line">*   e1e9c68 (HEAD -&gt; master) merge with no-ff</span>
<span class="line">|\  </span>
<span class="line">| * f52c633 (dev) add merge</span>
<span class="line">|/  </span>
<span class="line">*   cf810e4 conflict fixed</span>
<span class="line">...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/39-BnM7j0Dx.png"><p>可以看到，不使用<code>Fast forward</code>模式，merge后就像这样：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">                                 HEAD</span>
<span class="line">                                  │</span>
<span class="line">                                  ▼</span>
<span class="line">                                master</span>
<span class="line">                                  │</span>
<span class="line">                                  ▼</span>
<span class="line">                                ┌───┐</span>
<span class="line">                         ┌─────▶│   │</span>
<span class="line">┌───┐    ┌───┐    ┌───┐  │      └───┘</span>
<span class="line">│   │───▶│   │───▶│   │──┤        ▲</span>
<span class="line">└───┘    └───┘    └───┘  │  ┌───┐ │</span>
<span class="line">                         └─▶│   │─┘</span>
<span class="line">                            └───┘</span>
<span class="line">                              ▲</span>
<span class="line">                              │</span>
<span class="line">                             dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>分支策略</strong></p><p>在实际开发中，我们应该按照几个基本原则进行分支管理：</p><p>首先，<code>master</code>分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；</p><p>那在哪干活呢？干活都在<code>dev</code>分支上，也就是说，<code>dev</code>分支是不稳定的，到某个时候，比如1.0版本发布时，再把<code>dev</code>分支合并到<code>master</code>上，在<code>master</code>分支发布1.0版本；</p><p>你和你的小伙伴们每个人都在<code>dev</code>分支上干活，每个人都有自己的分支，时不时地往<code>dev</code>分支上合并就可以了。</p><p>所以，团队合作的分支看起来就像这样：</p><p><img src="https://liaoxuefeng.com/books/git/branch/policy/branches.png" alt="git-br-policy"></p><p><strong>小结</strong></p><p>Git分支十分强大，在团队开发中应该充分应用。</p><p>合并分支时，加上<code>--no-ff</code>参数就可以用普通模式合并，合并后的历史有分支，能看出来曾经做过合并，而<code>fast forward</code>合并就看不出来曾经做过合并。</p><h3 id="_6-4-bug分支" tabindex="-1"><a class="header-anchor" href="#_6-4-bug分支"><span>6.4 Bug分支</span></a></h3><p>软件开发中，bug就像家常便饭一样。有了bug就需要修复，在Git中，由于分支是如此的强大，所以，每个bug都可以通过一个新的临时分支来修复，修复后，合并分支，然后将临时分支删除。</p><p>当你接到一个修复一个代号101的bug的任务时，很自然地，你想创建一个分支<code>issue-101</code>来修复它，但是，等等，当前正在<code>dev</code>上进行的工作还没有提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch dev</span>
<span class="line">Changes to be committed:</span>
<span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="line"></span>
<span class="line">	new file:   hello.py</span>
<span class="line"></span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>并不是你不想提交，而是工作只进行到一半，还没法提交，预计完成还需1天时间。但是，必须在两个小时内修复该bug，怎么办？</p><p>幸好，Git还提供了一个<code>stash</code>功能，可以把当前工作现场“储藏”起来，等以后恢复现场后继续工作：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git stash</span>
<span class="line">Saved working directory and index state WIP on dev: f52c633 add merge</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/40-3zCesH_S.png"><p>现在，用<code>git status</code>查看工作区，就是干净的（除非有没有被Git管理的文件），因此可以放心地创建分支来修复bug。</p><p>首先确定要在哪个分支上修复bug，假定需要在<code>master</code>分支上修复，就从<code>master</code>创建临时分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git checkout master</span>
<span class="line">Switched to branch &#39;master&#39;</span>
<span class="line">Your branch is ahead of &#39;origin/master&#39; by 6 commits.</span>
<span class="line">  (use &quot;git push&quot; to publish your local commits)</span>
<span class="line"></span>
<span class="line">$ git checkout -b issue-101</span>
<span class="line">Switched to a new branch &#39;issue-101&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在修复bug，需要把“Git is free software ...”改为“Git is a free software ...”，然后提交：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add readme.txt </span>
<span class="line">$ git commit -m &quot;fix bug 101&quot;</span>
<span class="line">[issue-101 4c805e2] fix bug 101</span>
<span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/41-CLVgfMj9.png"><p>修复完成后，切换到<code>master</code>分支，并完成合并，最后删除<code>issue-101</code>分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch master</span>
<span class="line">Switched to branch &#39;master&#39;</span>
<span class="line">Your branch is ahead of &#39;origin/master&#39; by 6 commits.</span>
<span class="line">  (use &quot;git push&quot; to publish your local commits)</span>
<span class="line"></span>
<span class="line">$ git merge --no-ff -m &quot;merged bug fix 101&quot; issue-101</span>
<span class="line">Merge made by the &#39;recursive&#39; strategy.</span>
<span class="line"> readme.txt | 2 +-</span>
<span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/42-C7h-S-2G.png"><p>太棒了，原计划两个小时的bug修复只花了5分钟！现在，是时候接着回到<code>dev</code>分支干活了！</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch dev</span>
<span class="line">Switched to branch &#39;dev&#39;</span>
<span class="line"></span>
<span class="line">$ git status</span>
<span class="line">On branch dev</span>
<span class="line">nothing to commit, working tree clean</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>工作区是干净的，刚才的工作现场存到哪去了？用<code>git stash list</code>命令看看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git stash list</span>
<span class="line">stash@{0}: WIP on dev: f52c633 add merge</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>工作现场还在，Git把<code>stash</code>内容存在某个地方了，但是需要恢复一下，有两个办法：</p><p>一是用<code>git stash apply</code>恢复，但是恢复后，<code>stash</code>内容并不删除，你需要用<code>git stash drop</code>来删除；</p><p>另一种方式是用<code>git stash pop</code>，恢复的同时把<code>stash</code>内容也删了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git stash pop</span>
<span class="line">On branch dev</span>
<span class="line">Changes to be committed:</span>
<span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="line"></span>
<span class="line">	new file:   hello.py</span>
<span class="line"></span>
<span class="line">Changes not staged for commit:</span>
<span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="line"></span>
<span class="line">	modified:   readme.txt</span>
<span class="line"></span>
<span class="line">Dropped refs/stash@{0} (5d677e2ee266f39ea296182fb2354265b91b3b2a)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再用<code>git stash list</code>查看，就看不到任何<code>stash</code>内容了：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git stash list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="/assets/43-DoNcr1LT.png"><p>你可以多次<code>stash</code>，恢复的时候，先用<code>git stash list</code>查看，然后恢复指定的<code>stash</code>，用命令：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git stash apply stash@{0}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在<code>master</code>分支上修复了bug后，我们要想一想，<code>dev</code>分支是早期从<code>master</code>分支分出来的，所以，这个bug其实在当前<code>dev</code>分支上也存在。</p><p>那怎么在<code>dev</code>分支上修复同样的bug？重复操作一次，提交不就行了？</p><p>有木有更简单的方法？</p><p>有！</p><p>同样的bug，要在<code>dev</code>上修复，我们只需要把<code>4c805e2 fix bug 101</code>这个提交所做的修改“复制”到<code>dev</code>分支。注意：我们只想复制<code>4c805e2 fix bug 101</code>这个提交所做的修改，并不是把整个<code>master</code>分支merge过来。</p><p>为了方便操作，Git专门提供了一个<code>cherry-pick</code>命令，让我们能复制一个特定的提交到当前分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch</span>
<span class="line">* dev</span>
<span class="line">  master</span>
<span class="line">$ git cherry-pick 4c805e2</span>
<span class="line">[master 1d4b803] fix bug 101</span>
<span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/44-03BjFvU2.png"><p>Git自动给<code>dev</code>分支做了一次提交，注意这次提交的commit是<code>1d4b803</code>，它并不同于<code>master</code>的<code>4c805e2</code>，因为这两个commit只是改动相同，但确实是两个不同的commit。用<code>git cherry-pick</code>，我们就不需要在<code>dev</code>分支上手动再把修bug的过程重复一遍。</p><p>有些聪明的童鞋会想了，既然可以在<code>master</code>分支上修复bug后，在<code>dev</code>分支上可以“重放”这个修复过程，那么直接在<code>dev</code>分支上修复bug，然后在<code>master</code>分支上“重放”行不行？当然可以，不过你仍然需要<code>git stash</code>命令保存现场，才能从<code>dev</code>分支切换到<code>master</code>分支。</p><p><strong>小结</strong></p><p>修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；</p><p>当手头工作没有完成时，先把工作现场<code>git stash</code>一下，然后去修复bug，修复后，再<code>git stash pop</code>，回到工作现场；</p><p>在<code>master</code>分支上修复的bug，想要合并到当前<code>dev</code>分支，可以用<code>git cherry-pick &lt;commit&gt;</code>命令，把bug提交的修改“复制”到当前分支，避免重复劳动。</p><h3 id="_6-5-feature分支" tabindex="-1"><a class="header-anchor" href="#_6-5-feature分支"><span>6.5 Feature分支</span></a></h3><p>软件开发中，总有无穷无尽的新的功能要不断添加进来。</p><p>添加一个新功能时，你肯定不希望因为一些实验性质的代码，把主分支搞乱了，所以，每添加一个新功能，最好新建一个feature分支，在上面开发，完成后，合并，最后，删除该feature分支。</p><p>现在，你终于接到了一个新任务：开发代号为Vulcan的新功能，该功能计划用于下一代星际飞船。</p><p>于是准备开发：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch -c feature-vulcan</span>
<span class="line">Switched to a new branch &#39;feature-vulcan&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>5分钟后，开发完毕：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add vulcan.py</span>
<span class="line"></span>
<span class="line">$ git status</span>
<span class="line">On branch feature-vulcan</span>
<span class="line">Changes to be committed:</span>
<span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="line"></span>
<span class="line">	new file:   vulcan.py</span>
<span class="line"></span>
<span class="line">$ git commit -m &quot;add feature vulcan&quot;</span>
<span class="line">[feature-vulcan 287773e] add feature vulcan</span>
<span class="line"> 1 file changed, 2 insertions(+)</span>
<span class="line"> create mode 100644 vulcan.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>切回<code>dev</code>，准备合并：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git switch dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>一切顺利的话，feature分支和bug分支是类似的，合并，然后删除。</p><p>但是！</p><p>就在此时，接到上级命令，因经费不足，新功能必须取消！</p><p>虽然白干了，但是这个包含机密资料的分支还是必须就地销毁：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch -d feature-vulcan</span>
<span class="line">error: The branch &#39;feature-vulcan&#39; is not fully merged.</span>
<span class="line">If you are sure you want to delete it, run &#39;git branch -D feature-vulcan&#39;.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>销毁失败。Git友情提醒，<code>feature-vulcan</code>分支还没有被合并，如果删除，将丢失掉修改，如果要强行删除，需要使用大写的<code>-D</code>参数。。</p><p>现在我们强行删除：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch -D feature-vulcan</span>
<span class="line">Deleted branch feature-vulcan (was 287773e).</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><img src="/assets/45-BT4Sgcp5.png"><p>终于删除成功！</p><p><strong>小结</strong></p><p>开发一个新功能，最好新建一个分支；</p><p>如果要丢弃一个没有被合并过的分支，可以通过<code>git branch -D &lt;name&gt;</code>强行删除。</p><h3 id="_6-6-多人协作" tabindex="-1"><a class="header-anchor" href="#_6-6-多人协作"><span>6.6 多人协作</span></a></h3><p>当你从远程仓库克隆时，实际上Git自动把本地的<code>master</code>分支和远程的<code>master</code>分支对应起来了，并且，远程仓库的默认名称是<code>origin</code>。</p><p>要查看远程库的信息，用<code>git remote</code>：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git remote</span>
<span class="line">origin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>或者，用<code>git remote -v</code>显示更详细的信息：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git remote -v</span>
<span class="line">origin  git@github.com:michaelliao/learngit.git (fetch)</span>
<span class="line">origin  git@github.com:michaelliao/learngit.git (push)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面显示了可以抓取和推送的<code>origin</code>的地址。如果没有推送权限，就看不到push的地址。</p><p><strong>推送分支</strong></p><p>推送分支，就是把该分支上的所有本地提交推送到远程库。推送时，要指定本地分支，这样，Git就会把该分支推送到远程库对应的远程分支上：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git push origin master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果要推送其他分支，比如<code>dev</code>，就改成：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git push origin dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>但是，并不是一定要把本地分支往远程推送，那么，哪些分支需要推送，哪些不需要呢？</p><ul><li><code>master</code>分支是主分支，因此要时刻与远程同步；</li><li><code>dev</code>分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步；</li><li>bug分支只用于在本地修复bug，就没必要推到远程了，除非老板要看看你每周到底修复了几个bug；</li><li>feature分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发。</li></ul><p>总之，就是在Git中，分支完全可以在本地自己藏着玩，是否推送，视你的心情而定！</p><p><strong>抓取分支</strong></p><p>多人协作时，大家都会往<code>master</code>和<code>dev</code>分支上推送各自的修改。</p><p>现在，模拟一个你的小伙伴，可以在另一台电脑（注意要把SSH Key添加到GitHub）或者同一台电脑的另一个目录下克隆：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git clone git@github.com:michaelliao/learngit.git</span>
<span class="line">Cloning into &#39;learngit&#39;...</span>
<span class="line">remote: Counting objects: 40, done.</span>
<span class="line">remote: Compressing objects: 100% (21/21), done.</span>
<span class="line">remote: Total 40 (delta 14), reused 40 (delta 14), pack-reused 0</span>
<span class="line">Receiving objects: 100% (40/40), done.</span>
<span class="line">Resolving deltas: 100% (14/14), done.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当你的小伙伴从远程库clone时，默认情况下，你的小伙伴只能看到本地的<code>master</code>分支。不信可以用<code>git branch</code>命令看看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch</span>
<span class="line">* master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，你的小伙伴要在<code>dev</code>分支上开发，就必须创建远程<code>origin</code>的<code>dev</code>分支到本地，于是他用这个命令创建本地<code>dev</code>分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git checkout -b dev origin/dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>现在，他就可以在<code>dev</code>上继续修改，然后，时不时地把<code>dev</code>分支<code>push</code>到远程：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git add env.txt</span>
<span class="line"></span>
<span class="line">$ git commit -m &quot;add env&quot;</span>
<span class="line">[dev 7a5e5dd] add env</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"> create mode 100644 env.txt</span>
<span class="line"></span>
<span class="line">$ git push origin dev</span>
<span class="line">Counting objects: 3, done.</span>
<span class="line">Delta compression using up to 4 threads.</span>
<span class="line">Compressing objects: 100% (2/2), done.</span>
<span class="line">Writing objects: 100% (3/3), 308 bytes | 308.00 KiB/s, done.</span>
<span class="line">Total 3 (delta 0), reused 0 (delta 0)</span>
<span class="line">To github.com:michaelliao/learngit.git</span>
<span class="line">   f52c633..7a5e5dd  dev -&gt; dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你的小伙伴已经向<code>origin/dev</code>分支推送了他的提交，而碰巧你也对同样的文件作了修改，并试图推送：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ cat env.txt</span>
<span class="line">env</span>
<span class="line"></span>
<span class="line">$ git add env.txt</span>
<span class="line"></span>
<span class="line">$ git commit -m &quot;add new env&quot;</span>
<span class="line">[dev 7bd91f1] add new env</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"> create mode 100644 env.txt</span>
<span class="line"></span>
<span class="line">$ git push origin dev</span>
<span class="line">To github.com:michaelliao/learngit.git</span>
<span class="line"> ! [rejected]        dev -&gt; dev (non-fast-forward)</span>
<span class="line">error: failed to push some refs to &#39;git@github.com:michaelliao/learngit.git&#39;</span>
<span class="line">hint: Updates were rejected because the tip of your current branch is behind</span>
<span class="line">hint: its remote counterpart. Integrate the remote changes (e.g.</span>
<span class="line">hint: &#39;git pull ...&#39;) before pushing again.</span>
<span class="line">hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>推送失败，因为你的小伙伴的最新提交和你试图推送的提交有冲突，解决办法也很简单，Git已经提示我们，先用<code>git pull</code>把最新的提交从<code>origin/dev</code>抓下来，然后，在本地合并，解决冲突，再推送：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git pull</span>
<span class="line">There is no tracking information for the current branch.</span>
<span class="line">Please specify which branch you want to merge with.</span>
<span class="line">See git-pull(1) for details.</span>
<span class="line"></span>
<span class="line">    git pull &lt;remote&gt; &lt;branch&gt;</span>
<span class="line"></span>
<span class="line">If you wish to set tracking information for this branch you can do so with:</span>
<span class="line"></span>
<span class="line">    git branch --set-upstream-to=origin/&lt;branch&gt; dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>git pull</code>也失败了，原因是没有指定本地<code>dev</code>分支与远程<code>origin/dev</code>分支的链接，根据提示，设置<code>dev</code>和<code>origin/dev</code>的链接：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git branch --set-upstream-to=origin/dev dev</span>
<span class="line">Branch &#39;dev&#39; set up to track remote branch &#39;dev&#39; from &#39;origin&#39;.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>再pull：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git pull</span>
<span class="line">Auto-merging env.txt</span>
<span class="line">CONFLICT (add/add): Merge conflict in env.txt</span>
<span class="line">Automatic merge failed; fix conflicts and then commit the result.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这回<code>git pull</code>成功，但是合并有冲突，需要手动解决，解决的方法和分支管理中的<a href="https://liaoxuefeng.com/books/git/branch/merge/index.html" target="_blank" rel="noopener noreferrer">解决冲突<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>完全一样。解决后，提交，再push：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git commit -m &quot;fix env conflict&quot;</span>
<span class="line">[dev 57c53ab] fix env conflict</span>
<span class="line"></span>
<span class="line">$ git push origin dev</span>
<span class="line">Counting objects: 6, done.</span>
<span class="line">Delta compression using up to 4 threads.</span>
<span class="line">Compressing objects: 100% (4/4), done.</span>
<span class="line">Writing objects: 100% (6/6), 621 bytes | 621.00 KiB/s, done.</span>
<span class="line">Total 6 (delta 0), reused 0 (delta 0)</span>
<span class="line">To github.com:michaelliao/learngit.git</span>
<span class="line">   7a5e5dd..57c53ab  dev -&gt; dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因此，多人协作的工作模式通常是这样：</p><ol><li>首先，可以尝试用<code>git push origin &lt;branch-name&gt;</code>推送自己的修改；</li><li>如果推送失败，则因为远程分支比你的本地更新，需要先用<code>git pull</code>试图合并；</li><li>如果合并有冲突，则解决冲突，并在本地提交；</li><li>没有冲突或者解决掉冲突后，再用<code>git push origin &lt;branch-name&gt;</code>推送就能成功！</li></ol><p>如果<code>git pull</code>提示<code>no tracking information</code>，则说明本地分支和远程分支的链接关系没有创建，用命令<code>git branch --set-upstream-to &lt;branch-name&gt; origin/&lt;branch-name&gt;</code>。</p><p>这就是多人协作的工作模式，一旦熟悉了，就非常简单。</p><p><strong>小结</strong></p><ul><li><p>查看远程库信息，使用<code>git remote -v</code>；</p></li><li><p>本地新建的分支如果不推送到远程，对其他人就是不可见的；</p></li><li><p>从本地推送分支，使用<code>git push origin branch-name</code>，如果推送失败，先用<code>git pull</code>抓取远程的新提交；</p></li><li><p>在本地创建和远程分支对应的分支，使用<code>git checkout -b branch-name origin/branch-name</code>，本地和远程分支的名称最好一致；</p></li><li><p>建立本地分支和远程分支的关联，使用<code>git branch --set-upstream branch-name origin/branch-name</code>；</p></li><li><p>从远程抓取分支，使用<code>git pull</code>，如果有冲突，要先处理冲突。</p></li></ul><h3 id="_6-7-rebase" tabindex="-1"><a class="header-anchor" href="#_6-7-rebase"><span>6.7 Rebase</span></a></h3><p>在上一节我们看到了，多人在同一个分支上协作时，很容易出现冲突。即使没有冲突，后push的童鞋不得不先pull，在本地合并，然后才能push成功。</p><p>每次合并再push后，分支变成了这样：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span>
<span class="line">* d1be385 (HEAD -&gt; master, origin/master) init hello</span>
<span class="line">*   e5e69f1 Merge branch &#39;dev&#39;</span>
<span class="line">|\  </span>
<span class="line">| *   57c53ab (origin/dev, dev) fix env conflict</span>
<span class="line">| |\  </span>
<span class="line">| | * 7a5e5dd add env</span>
<span class="line">| * | 7bd91f1 add new env</span>
<span class="line">| |/  </span>
<span class="line">* |   12a631b merged bug fix 101</span>
<span class="line">|\ \  </span>
<span class="line">| * | 4c805e2 fix bug 101</span>
<span class="line">|/ /  </span>
<span class="line">* |   e1e9c68 merge with no-ff</span>
<span class="line">|\ \  </span>
<span class="line">| |/  </span>
<span class="line">| * f52c633 add merge</span>
<span class="line">|/  </span>
<span class="line">*   cf810e4 conflict fixed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总之看上去很乱，有强迫症的童鞋会问：为什么Git的提交历史不能是一条干净的直线？</p><p>其实是可以做到的！</p><p>Git有一种称为<code>rebase</code>的操作。</p><p>在和远程分支同步后，我们对<code>hello.py</code>这个文件做了两次提交。用<code>git log</code>命令看看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span>
<span class="line">* 582d922 (HEAD -&gt; master) add author</span>
<span class="line">* 8875536 add comment</span>
<span class="line">* d1be385 (origin/master) init hello</span>
<span class="line">*   e5e69f1 Merge branch &#39;dev&#39;</span>
<span class="line">|\  </span>
<span class="line">| *   57c53ab (origin/dev, dev) fix env conflict</span>
<span class="line">| |\  </span>
<span class="line">| | * 7a5e5dd add env</span>
<span class="line">| * | 7bd91f1 add new env</span>
<span class="line">...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意到Git用<code>(HEAD -&gt; master)</code>和<code>(origin/master)</code>标识出当前分支的HEAD和远程origin的位置分别是<code>582d922 add author</code>和<code>d1be385 init hello</code>，本地分支比远程分支快两个提交。</p><p>现在我们尝试推送本地分支：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git push origin master</span>
<span class="line">To github.com:michaelliao/learngit.git</span>
<span class="line"> ! [rejected]        master -&gt; master (fetch first)</span>
<span class="line">error: failed to push some refs to &#39;git@github.com:michaelliao/learngit.git&#39;</span>
<span class="line">hint: Updates were rejected because the remote contains work that you do</span>
<span class="line">hint: not have locally. This is usually caused by another repository pushing</span>
<span class="line">hint: to the same ref. You may want to first integrate the remote changes</span>
<span class="line">hint: (e.g., &#39;git pull ...&#39;) before pushing again.</span>
<span class="line">hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>很不幸，失败了，这说明有人先于我们推送了远程分支。按照经验，先pull一下：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git pull</span>
<span class="line">remote: Counting objects: 3, done.</span>
<span class="line">remote: Compressing objects: 100% (1/1), done.</span>
<span class="line">remote: Total 3 (delta 1), reused 3 (delta 1), pack-reused 0</span>
<span class="line">Unpacking objects: 100% (3/3), done.</span>
<span class="line">From github.com:michaelliao/learngit</span>
<span class="line">   d1be385..f005ed4  master     -&gt; origin/master</span>
<span class="line"> * [new tag]         v1.0       -&gt; v1.0</span>
<span class="line">Auto-merging hello.py</span>
<span class="line">Merge made by the &#39;recursive&#39; strategy.</span>
<span class="line"> hello.py | 1 +</span>
<span class="line"> 1 file changed, 1 insertion(+)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再用<code>git status</code>看看状态：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git status</span>
<span class="line">On branch master</span>
<span class="line">Your branch is ahead of &#39;origin/master&#39; by 3 commits.</span>
<span class="line">  (use &quot;git push&quot; to publish your local commits)</span>
<span class="line"></span>
<span class="line">nothing to commit, working tree clean</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加上刚才合并的提交，现在我们本地分支比远程分支超前3个提交。</p><p>用<code>git log</code>看看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span>
<span class="line">*   e0ea545 (HEAD -&gt; master) Merge branch &#39;master&#39; of github.com:michaelliao/learngit</span>
<span class="line">|\  </span>
<span class="line">| * f005ed4 (origin/master) set exit=1</span>
<span class="line">* | 582d922 add author</span>
<span class="line">* | 8875536 add comment</span>
<span class="line">|/  </span>
<span class="line">* d1be385 init hello</span>
<span class="line">...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个时候，rebase就派上了用场。我们输入命令<code>git rebase</code>试试：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git rebase</span>
<span class="line">First, rewinding head to replay your work on top of it...</span>
<span class="line">Applying: add comment</span>
<span class="line">Using index info to reconstruct a base tree...</span>
<span class="line">M	hello.py</span>
<span class="line">Falling back to patching base and 3-way merge...</span>
<span class="line">Auto-merging hello.py</span>
<span class="line">Applying: add author</span>
<span class="line">Using index info to reconstruct a base tree...</span>
<span class="line">M	hello.py</span>
<span class="line">Falling back to patching base and 3-way merge...</span>
<span class="line">Auto-merging hello.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出了一大堆操作，到底是啥效果？再用<code>git log</code>看看：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span>
<span class="line">* 7e61ed4 (HEAD -&gt; master) add author</span>
<span class="line">* 3611cfe add comment</span>
<span class="line">* f005ed4 (origin/master) set exit=1</span>
<span class="line">* d1be385 init hello</span>
<span class="line">...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原本分叉的提交现在变成一条直线了！这种神奇的操作是怎么实现的？其实原理非常简单。我们注意观察，发现Git把我们本地的提交“挪动”了位置，放到了<code>f005ed4 (origin/master) set exit=1</code>之后，这样，整个提交历史就成了一条直线。rebase操作前后，最终的提交内容是一致的，但是，我们本地的commit修改内容已经变化了，它们的修改不再基于<code>d1be385 init hello</code>，而是基于<code>f005ed4 (origin/master) set exit=1</code>，但最后的提交<code>7e61ed4</code>内容是一致的。</p><p>这就是rebase操作的特点：把分叉的提交历史“整理”成一条直线，看上去更直观。缺点是本地的分叉提交已经被修改过了。</p><p>最后，通过push操作把本地分支推送到远程：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">Mac:~/learngit michael$ git push origin master</span>
<span class="line">Counting objects: 6, done.</span>
<span class="line">Delta compression using up to 4 threads.</span>
<span class="line">Compressing objects: 100% (5/5), done.</span>
<span class="line">Writing objects: 100% (6/6), 576 bytes | 576.00 KiB/s, done.</span>
<span class="line">Total 6 (delta 2), reused 0 (delta 0)</span>
<span class="line">remote: Resolving deltas: 100% (2/2), completed with 1 local object.</span>
<span class="line">To github.com:michaelliao/learngit.git</span>
<span class="line">   f005ed4..7e61ed4  master -&gt; master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再用<code>git log</code>看看效果：</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain" data-title="plain"><pre><code><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span>
<span class="line">* 7e61ed4 (HEAD -&gt; master, origin/master) add author</span>
<span class="line">* 3611cfe add comment</span>
<span class="line">* f005ed4 set exit=1</span>
<span class="line">* d1be385 init hello</span>
<span class="line">...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>远程分支的提交历史也是一条直线。</p><p><strong>小结</strong></p><ul><li>rebase操作可以把本地未push的分叉提交历史整理成直线；</li><li>rebase的目的是使得我们在查看历史提交的变化时更容易，因为分叉的提交需要三方对比。</li></ul></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 2025/9/25 17:02:14<!--]--></span></span></div></footer><!----><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/test/git/git.html#_1-什么是git" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.什么是Git"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.什么是Git<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/test/git/git.html#_2-安装git" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.安装Git"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.安装Git<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_2-1-在windows上安装git" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.1 在Windows上安装Git"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.1 在Windows上安装Git<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_2-2-配置git" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.2 配置Git"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.2 配置Git<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/test/git/git.html#_3-创建版本库" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.创建版本库"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.创建版本库<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/test/git/git.html#_4-版本管理" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.版本管理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.版本管理<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_4-1-版本回退" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.1 版本回退"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.1 版本回退<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_4-2-工作区和暂存区" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.2 工作区和暂存区"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.2 工作区和暂存区<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_4-3-管理修改" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.3 管理修改"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.3 管理修改<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_4-4-撤销修改" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.4 撤销修改"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.4 撤销修改<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_4-5-删除文件" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.5 删除文件"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.5 删除文件<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/test/git/git.html#_5-远程仓库" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5.远程仓库"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5.远程仓库<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#使用guthub" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="使用GutHub"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->使用GutHub<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#使用gitee" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="使用Gitee"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->使用Gitee<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_5-1-添加远程库" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5.1 添加远程库"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5.1 添加远程库<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_5-2-从远程库克隆" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5.2 从远程库克隆"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5.2 从远程库克隆<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/test/git/git.html#_6-分支管理" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.分支管理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.分支管理<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_6-1-创建与合并分支" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.1 创建与合并分支"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.1 创建与合并分支<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_6-2-解决冲突" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.2 解决冲突"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.2 解决冲突<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_6-3-分支管理策略" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.3 分支管理策略"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.3 分支管理策略<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_6-4-bug分支" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.4 Bug分支"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.4 Bug分支<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_6-5-feature分支" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.5 Feature分支"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.5 Feature分支<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_6-6-多人协作" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.6 多人协作"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.6 多人协作<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/test/git/git.html#_6-7-rebase" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6.7 Rebase"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6.7 Rebase<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Ch_-uG_H.js" defer></script>
  </body>
</html>
